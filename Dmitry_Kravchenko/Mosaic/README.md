# Мозаичная обработка изображений и аннотаций для балансировки классов

Этот проект реализует создание мозаичных изображений для балансировки классов в датасетах, в которых изображения содержат несколько объектов разных классов. Основной задачей является обеспечение сбалансированного представления классов в датасете с помощью генерации мозаичных изображений.

## Функциональность

1. **Фильтрация изображений**: Исключение изображений, содержащих больше 5 экземпляров одного класса, чтобы избежать чрезмерного присутствия одного класса в процессе создания мозаик.
2. **Создание мозаик**: Использование отфильтрованных изображений для создания мозаичных изображений размером 8x8 с регулировкой количества экземпляров каждого класса.
3. **Сохранение изображений и аннотаций**: Мозаичные изображения и их аннотации сохраняются в указанных директориях.
4. **Визуализация**: Возможность визуализировать результаты мозаичной обработки и аннотации на изображениях.
5. **Создание графиков распределения классов**: До и после мозаичной обработки можно визуализировать распределение классов в датасете.

## Установка

1. Клонируйте этот репозиторий:
    ```bash
    git clone https://github.com/NeuronsUII/Vtormet_n/tree/main/Dmitry_Kravchenko/Mosaic.git
    ```

2. Установите необходимые зависимости:
    ```bash
    pip install opencv-python matplotlib numpy
    ```

## Использование

### Подготовка данных

Убедитесь, что у вас есть папки с изображениями и соответствующими аннотациями. Структура должна быть следующей:

dataset/
images/ # Папка с изображениями (.jpg, .png и т.д.)
labels/ # Папка с аннотациями в формате YOLO (.txt)
python
Копировать код

### Пример использования

Для выполнения мозаичной обработки выполните следующие шаги:

1. Отредактируйте пути к изображениям и аннотациям в коде:

    ```python
    image_dir = r'C:\path\to\dataset\images'
    label_dir = r'C:\path\to\dataset\labels'
    output_image_dir = r'C:\path\to\output\mosaic\images'
    output_label_dir = r'C:\path\to\output\mosaic\labels'
    ```

2. Запустите код для фильтрации изображений и создания мозаик:

    ```python
    # Фильтрация изображений, в которых больше 5 экземпляров одного класса
    filtered_image_paths, filtered_label_paths = filter_images_by_class_count(label_paths, max_class_instances=5)

    # Вызов функции мозаичной обработки
    mosaic_augmentation(filtered_image_paths, filtered_label_paths, output_image_dir, output_label_dir, mosaic_size=8, mosaic_image_size=640, target_class_instances=2000)
    ```

### Фильтрация изображений

Фильтрация изображений выполняется с помощью функции `filter_images_by_class_count`, которая удаляет изображения, содержащие более 5 экземпляров одного и того же класса:

```python
filtered_image_paths, filtered_label_paths = filter_images_by_class_count(label_paths, max_class_instances=5)
Создание мозаичных изображений
Основная функция mosaic_augmentation создаёт мозаики, используя отфильтрованные изображения, и сохраняет результаты в указанных папках:

python
Копировать код
mosaic_augmentation(filtered_image_paths, filtered_label_paths, output_image_dir, output_label_dir, mosaic_size=8, mosaic_image_size=640, target_class_instances=2000)

## Визуализация
Для визуализации результатов после создания мозаичных изображений можно воспользоваться функцией visualize_mosaic_images для просмотра изображений:

python
Копировать код
visualize_mosaic_images(output_image_dir, num_images=3)
Также доступна функция для визуализации аннотаций на изображениях:

python
Копировать код
visualize_annotations(output_image_dir, output_label_dir, num_images=3)
Графики распределения классов
Чтобы посмотреть, как изменилось распределение классов до и после мозаичной обработки, можно использовать функцию plot_class_distribution_with_stats:

python
Копировать код
plot_class_distribution_with_stats(class_counter_before, class_counter_after, total_instances_before, total_instances_after, output_graph_path)
Настройки
mosaic_size: размер сетки для мозаики, по умолчанию 8x8.
mosaic_image_size: размер выходного мозаичного изображения, по умолчанию 640x640 пикселей.
target_class_instances: желаемое количество экземпляров для каждого класса в итоговом датасете.

# Лицензия
Этот проект распространяется под лицензией MIT. Подробности см. в файле LICENSE.

markdown
Копировать код

### Описание разделов:
- **Установка**: содержит шаги для клонирования репозитория и установки необходимых зависимостей.
- **Использование**: описывает, как использовать код для создания мозаичных изображений и включает примеры кода.
- **Визуализация** и **Графики**: даются инструкции по визуализации и построению графиков распределения классов.
- **Настройки**: объясняются ключевые параметры, которые можно настроить в процессе создания мозаик.

Этот `README.md` можно использовать для вашего проекта, описывая все необходимые аспекты его использовани